<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Edit test message</title>
  </head>
  <body>
    <h1>Edit test message</h1>

    <p>Current: <span id="current">loading‚Ä¶</span></p>

    <p>
      New message:
      <input id="newMsg" />
      <button id="saveBtn">Save</button>
    </p>

    <p id="status"></p>

    <script>
      // üëâ Same endpoint as viewer
      const SERVICE = "https://msswidget-service.onrender.com/testform.json";
      // const SERVICE = "http://localhost:3000/testform.json"; // for local

      async function load() {
        try {
          const res = await fetch(SERVICE, { cache: "no-store" });
          const data = await res.json();
          document.getElementById("current").textContent =
            data.message || "";
          document.getElementById("newMsg").value = data.message || "";
        } catch (e) {
          document.getElementById("status").textContent = "load failed";
        }
      }

      async function save() {
        const msg = document.getElementById("newMsg").value;
        try {
          const res = await fetch(SERVICE, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ message: msg })
          });
          const data = await res.json();
          document.getElementById("status").textContent = "saved ‚úÖ";
          document.getElementById("current").textContent = data.message || "";
        } catch (e) {
          document.getElementById("status").textContent = "save failed ‚ùå";
        }
      }

      document
        .getElementById("saveBtn")
        .addEventListener("click", save);

      load();
    </script>
  </body>
</html>
